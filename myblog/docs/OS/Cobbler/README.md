# Cobbler自动化系统安装环境配置

网络安装服务器套件 Cobbler(补鞋匠)是RedHat在2008年发布的，用于快速建立Linux网络安装环境。今天我们就用Cobbler来配置一套自动化系统安装环境。

## 0. 参考文档

- Cobbler官方文档：[https://cobbler.readthedocs.io/en/latest/](https://cobbler.readthedocs.io/en/latest/)
- Cobbler官网地址：[https://github.com/cobbler/cobbler](https://github.com/cobbler/cobbler)

## 1. 环境说明

- 宿主机：系统`Ubuntu 20.04.2 LTS`，IP:192.168.2.113。
- 虚拟化工具：VirtualBox 6.1.22。
- 虚拟机: 采用桥接网卡创建一个CentOS7虚拟机，命名为`cobbler-master`。

虚拟机创建注意事项：

- `VirtualBox`中设置虚拟机内存大小2048MB。
- `VirtualBox`中设置虚拟机虚拟分配空间40GB，此处空间稍微分配大一点，因为需要存放系统镜像，可能会占用较多空间。
- `VirtualBox`中设置虚拟机配置网卡1，启用网络连接，并设置连接方式为"桥接网卡"。

虚拟机其他信息：

操作系统：

```sh
[root@localhost ~]# cat /etc/centos-release
CentOS Linux release 7.9.2009 (Core)
```

配置静态IP地址:

```sh
[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-enp0s3 
TYPE="Ethernet"
PROXY_METHOD="none"
BROWSER_ONLY="no"
BOOTPROTO="none"
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_FAILURE_FATAL="no"
IPV6_ADDR_GEN_MODE="stable-privacy"
NAME="enp0s3"
UUID="cde3dfd3-712f-40a3-9ab7-aa8d0fc31448"
DEVICE="enp0s3"
ONBOOT="yes"
IPADDR="192.168.2.20"
PREFIX="24"
GATEWAY="192.168.2.1"
IPV6_PRIVACY="no"
DNS1="192.168.2.1"
[root@localhost ~]# 
```

在安装虚拟机过程中，可以在网络配置时先选择DHCP方式自动连接网络，网络连接成功后，可以看到IP、网关、子网掩码、DNS等信息，将其记录下来，然后手动配置IP即可。

查看IP、网关、子网掩码、DNS等信息：

```sh
# IP信息,此处的192.168.2.20就是虚拟机的IP地址
[root@localhost ~]# ip a show enp0s3
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:87:c2:4e brd ff:ff:ff:ff:ff:ff
    inet 192.168.2.20/24 brd 192.168.2.255 scope global noprefixroute enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::d972:e36b:31ff:8dd1/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever

# 网关信息，此处第2列的192.168.2.1就是网关IP地址
# 子网掩码信息，此处第3列的255.255.255.0则是子网掩码
[root@localhost ~]# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.2.1     0.0.0.0         UG    100    0        0 enp0s3
192.168.2.0     0.0.0.0         255.255.255.0   U     100    0        0 enp0s3

# DNS域名服务器信息，此处的192.168.2.1则是域名服务器IP地址
[root@localhost ~]# cat /etc/resolv.conf 
# Generated by NetworkManager
nameserver 192.168.2.1
```

记录好这些信息，后面配置Cobbler DHCP时需要使用到。



另外，我们关闭VirtualBox主机网络管理器中的"DHCP服务器"，不启用服务器即可。

